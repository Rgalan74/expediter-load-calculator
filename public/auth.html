<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acceso a la App</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .tab-btn.active {
      background-color: #1e40af;
      color: white;
    }
    .tab-btn {
      transition: all 0.3s ease;
    }
    .tab-btn:hover {
      background-color: #374151;
      color: white;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen relative overflow-hidden">

<!-- Imagen de fondo -->
<div class="absolute inset-0 z-0">
  <img src="img/van-background.jpeg" alt="Van Background" class="w-full h-full object-cover opacity-100" />
</div>

<!-- Capa de oscurecimiento -->
<div class="absolute inset-0 bg-black bg-opacity-60 z-10"></div>

<!-- Header -->
<header class="relative z-20 bg-transparent py-4 px-6 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <img src="img/logo-app.png" alt="Logo" class="w-14 h-14 rounded-full border border-gray-300 shadow" />
    <span class="text-xl font-bold text-white">Expediter Load Calculator</span>
  </div>
</header>

<!-- Hero y formulario con tabs -->
<main class="relative z-20 flex flex-col items-center justify-center min-h-screen px-4">
  <div class="max-w-3xl w-full bg-white bg-opacity-90 text-gray-900 rounded-xl shadow-lg p-8">
    <div class="text-center mb-6">
      <h1 class="text-2xl font-bold text-gray-900">Bienvenido</h1>
      <p class="text-sm text-gray-600">Convierte tu van en una m√°quina de ganancias üöêüí∞</p>
    </div>

    <!-- Tabs -->
    <div class="flex justify-center mb-6 space-x-4">
      <button id="tabLogin" class="tab-btn px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-800">
        Iniciar sesi√≥n
      </button>
      <button id="tabRegister" class="tab-btn px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-800">
        Registrarse
      </button>
    </div>

    <!-- Formulario Login -->
    <div id="loginPanel" class="tab-content">
      <form id="loginForm" class="space-y-4">
        <div>
          <input 
            name="email" 
            type="email" 
            placeholder="Correo electr√≥nico" 
            class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none" 
            required 
          />
        </div>
        <div>
          <input 
            name="password" 
            type="password" 
            placeholder="Contrase√±a" 
            class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none" 
            required 
          />
        </div>
        <button 
          type="submit" 
          class="bg-blue-600 text-white px-4 py-3 w-full rounded-lg hover:bg-blue-700 font-semibold transition duration-300"
        >
          Iniciar sesi√≥n
        </button>
      </form>
    </div>

    <!-- Formulario Registro -->
    <div id="registerPanel" class="tab-content hidden">
      <form id="registerForm" class="space-y-4">
        <div>
          <input 
            name="fullName" 
            type="text" 
            placeholder="Nombre completo" 
            class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none" 
            required 
          />
        </div>
        <div>
          <input 
            name="email" 
            type="email" 
            placeholder="Correo electr√≥nico" 
            class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none" 
            required 
          />
        </div>
        <div>
          <input 
            name="password" 
            type="password" 
            placeholder="Contrase√±a (m√≠nimo 6 caracteres)" 
            class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none" 
            required 
          />
        </div>
        <div>
          <input 
            name="phone" 
            type="text" 
            placeholder="Tel√©fono (opcional)" 
            class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none" 
          />
        </div>
        <div>
          <input 
            name="company" 
            type="text" 
            placeholder="Empresa o marca (opcional)" 
            class="border border-gray-300 p-3 w-full rounded-lg focus:border-blue-500 focus:outline-none" 
          />
        </div>
        <button 
          type="submit" 
          class="bg-green-600 text-white px-4 py-3 w-full rounded-lg hover:bg-green-700 font-semibold transition duration-300"
        >
          Crear cuenta
        </button>
      </form>
    </div>

    <!-- Mensaje de estado -->
    <p id="authMessage" class="text-center text-sm text-red-600 mt-4 hidden"></p>
    
    <!-- Link para volver al inicio -->
    <div class="text-center mt-6">
      <a href="index.html" class="text-blue-600 hover:text-blue-800 text-sm">
        ‚Üê Volver al inicio
      </a>
    </div>
  </div>
</main>

<!-- Firebase CDN (versi√≥n 9 compatible) -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>

<script>
// Configuraci√≥n de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAkEYDbxkjXJx5wNh_7wMdIqmklOMCIyHY",
  authDomain: "expediter-dev.firebaseapp.com",
  projectId: "expediter-dev",
  storageBucket: "expediter-dev.appspot.com",
  messagingSenderId: "447653997176",
  appId: "1:447653997176:web:4e356867bb64b488ab5b8d"
};

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);

// ‚úÖ Helper function para mostrar mensajes
function showMessage(message, type = "info") {
  const authMessage = document.getElementById("authMessage");
  if (!authMessage) {
    console.log(message);
    return;
  }

  // Limpiar clases anteriores
  authMessage.className = "text-center text-sm mt-4";
  
  // Agregar clase seg√∫n tipo
  switch (type) {
    case "success":
      authMessage.className += " text-green-600";
      break;
    case "error":
      authMessage.className += " text-red-600";
      break;
    default:
      authMessage.className += " text-blue-600";
      break;
  }
  
  authMessage.textContent = message;
  authMessage.classList.remove("hidden");
  
  // Auto-hide despu√©s de 5 segundos
  setTimeout(() => {
    authMessage.classList.add("hidden");
  }, 5000);
}

function hideMessage() {
  const authMessage = document.getElementById("authMessage");
  if (authMessage) {
    authMessage.classList.add("hidden");
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const loginForm = document.getElementById("loginForm");
  const registerForm = document.getElementById("registerForm");
  const loginPanel = document.getElementById("loginPanel");
  const registerPanel = document.getElementById("registerPanel");
  const tabLogin = document.getElementById("tabLogin");
  const tabRegister = document.getElementById("tabRegister");

  console.log("üöÄ Auth page loaded");

  // Verificar si el usuario ya est√° autenticado
  firebase.auth().onAuthStateChanged((user) => {
    if (user) {
      console.log("‚úÖ User already authenticated, redirecting...");
      showMessage("Ya has iniciado sesi√≥n, redirigiendo...", "success");
      setTimeout(() => {
        window.location.href = "app.html";
      }, 1000);
    }
  });

  async function handleLoginSubmit(form) {
    const email = form.email.value.trim();
    const password = form.password.value.trim();
    
    console.log("üîë Attempting login for:", email);
    
    if (!email || !password) {
      showMessage("‚ö†Ô∏è Todos los campos son obligatorios", "error");
      return;
    }
    
    try {
      showMessage("Iniciando sesi√≥n...", "info");
      const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
      console.log("‚úÖ Login successful:", userCredential.user.email);
      showMessage("‚úÖ Inicio de sesi√≥n exitoso, redirigiendo...", "success");
      
      // Redirect after a short delay
      setTimeout(() => {
        window.location.href = "app.html";
      }, 1500);
    } catch (error) {
      console.error("‚ùå Error en login:", error);
      showMessage("‚ùå " + formatFirebaseError(error), "error");
    }
  }

  async function handleRegisterSubmit(form) {
    const fullName = form.fullName.value.trim();
    const email = form.email.value.trim();
    const password = form.password.value.trim();
    const phone = form.phone.value.trim();
    const company = form.company.value.trim();
    
    console.log("üìù Attempting registration for:", email);
    
    if (!fullName || !email || !password) {
      showMessage("‚ö†Ô∏è Nombre, correo y contrase√±a son obligatorios", "error");
      return;
    }
    
    if (password.length < 6) {
      showMessage("‚ö†Ô∏è La contrase√±a debe tener al menos 6 caracteres", "error");
      return;
    }
    
    try {
      showMessage("Creando cuenta...", "info");
      const userCred = await firebase.auth().createUserWithEmailAndPassword(email, password);
      console.log("‚úÖ Registration successful:", userCred.user.email);
      
      // Guardar informaci√≥n adicional del usuario
      await firebase.firestore().collection("users").doc(userCred.user.uid).set({
        fullName,
        email,
        phone,
        company,
        suscripcionActiva: false,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      console.log("‚úÖ User profile saved");
      showMessage("‚úÖ Cuenta creada exitosamente, redirigiendo...", "success");
      
      // Redirect after a short delay
      setTimeout(() => {
        window.location.href = "app.html";
      }, 1500);
    } catch (error) {
      console.error("‚ùå Error en registro:", error);
      showMessage("‚ùå " + formatFirebaseError(error), "error");
    }
  }

  function setActiveAuthTab(tab) {
    const isLogin = tab === "login";
    
    loginPanel.classList.toggle("hidden", !isLogin);
    registerPanel.classList.toggle("hidden", isLogin);
    
    tabLogin.classList.toggle("active", isLogin);
    tabRegister.classList.toggle("active", !isLogin);
    
    hideMessage();
    
    if (loginForm) loginForm.reset();
    if (registerForm) registerForm.reset();
  }

  function formatFirebaseError(error) {
    if (!error || !error.code) return error?.message || "Error desconocido";
    
    switch (error.code) {
      case "auth/email-already-in-use":
        return "El correo ya est√° registrado";
      case "auth/invalid-email":
        return "Correo electr√≥nico inv√°lido";
      case "auth/weak-password":
        return "La contrase√±a debe tener al menos 6 caracteres";
      case "auth/user-not-found":
        return "Usuario no encontrado";
      case "auth/wrong-password":
        return "Contrase√±a incorrecta";
      case "auth/invalid-credential":
        return "Credenciales inv√°lidas";
      case "auth/too-many-requests":
        return "Demasiados intentos fallidos. Intenta m√°s tarde";
      case "auth/network-request-failed":
        return "Error de conexi√≥n. Verifica tu internet";
      default:
        return error.message || "Error desconocido";
    }
  }

  // Event listeners
  if (loginForm) {
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      handleLoginSubmit(e.target);
    });
  }

  if (registerForm) {
    registerForm.addEventListener("submit", (e) => {
      e.preventDefault();
      handleRegisterSubmit(e.target);
    });
  }

  if (tabLogin) {
    tabLogin.addEventListener("click", () => setActiveAuthTab("login"));
  }

  if (tabRegister) {
    tabRegister.addEventListener("click", () => setActiveAuthTab("register"));
  }

  // Establecer tab inicial
  const tabFromUrl = new URLSearchParams(window.location.search).get("tab");
  setActiveAuthTab(tabFromUrl === "register" ? "register" : "login");
  
  console.log("‚úÖ Auth page setup complete");
});
</script>

</body>
</html>