
    <!-- Scripts de la aplicación EN ESTE ORDEN -->
    <!-- Scripts de la aplicación EN ESTE ORDEN -->

    <!-- New modules - Load first -->
    <!-- MOCK DATA for V2 testing - Comment out to use real Firebase -->
    <script src="js/mock-data.js"></script>

    <script src="js/security.js"></script>
    <script src="js/ui-feedback.js"></script>

    <!-- Existing scripts -->
    <script src="js/config.js"></script>
    <script src="js/helpers.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/calculator.js?v=2.1.1"></script>
    <script src="js/userPlans.js"></script>
    <script src="js/history.js?v=2.0.1"></script>
    <script src="js/finances.js?v=3.1.1"></script>
    <script src="js/zones.js"></script>
    <script src="js/main.js"></script>
    <script src="js/core/agent-base.js"></script>
    <script src="js/core/event-bus.js"></script>
    <script src="js/core/lex-master.js"></script>
    <script src="js/lex-ai-brain.js"></script>
    <script src="js/core/lex-modals.js"></script>
    <script src="js/lex-learning.js"></script>
    <script src="js/lex.js"></script>
    <script src="js/lex-intents.js"></script>
    <script src="js/lex-router.js"></script>

    <!-- Agentes -->
    <script src="js/agents/calculator-agent.js"></script>
    <script src="js/agents/history-agent.js"></script>
    <script src="js/agents/zones-agent.js"></script>
    <script src="js/agents/finances-agent.js"></script>

    <!-- <script src="js/tabs.js"></script> REMOVED: tabs.js functionality merged into main.js -->
    <script src="js/mobile.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="js/zones-print.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const toggle = document.getElementById("menuToggle");
        const menu = document.getElementById("mobileMenu");

        // Función para cerrar el menú móvil
        function closeMobileMenu() {
          if (menu && !menu.classList.contains("scale-y-0")) {
            menu.classList.remove("scale-y-100", "opacity-100");
            menu.classList.add("scale-y-0", "opacity-0");
            setTimeout(() => {
              if (menu.classList.contains("scale-y-0")) {
                menu.classList.add("hidden");
              }
            }, 300);
          }
        }

        // Función para mostrar/ocultar botón hamburguesa según el tamaño de pantalla
        function updateMenuToggle() {
          if (window.innerWidth >= 768) {
            toggle.style.display = "none";
          } else {
            toggle.style.display = "block";
          }
        }

        if (toggle && menu) {
          // Inicializar visibilidad del botón hamburguesa
          updateMenuToggle();
          window.addEventListener("resize", updateMenuToggle);

          // Toggle del menú hamburguesa
          toggle.addEventListener("click", () => {
            if (menu.classList.contains("scale-y-0")) {
              // Mostrar menú con animación
              menu.classList.remove("hidden", "scale-y-0", "opacity-0");
              menu.classList.add("scale-y-100", "opacity-100");
            } else {
              // Ocultar menú con animación
              closeMobileMenu();
            }
          });

          // 1. Cerrar menú al hacer clic en cualquier tab del menú móvil
          const mobileMenuTabs = menu.querySelectorAll(".tab-link");
          mobileMenuTabs.forEach(tab => {
            tab.addEventListener("click", () => {
              closeMobileMenu();
            });
          });

          // 2. Cerrar menú al hacer clic fuera de él
          document.addEventListener("click", (event) => {
            // Si el menú está visible
            if (!menu.classList.contains("scale-y-0")) {
              // Si el clic NO fue en el menú ni en el botón hamburguesa
              if (!menu.contains(event.target) && !toggle.contains(event.target)) {
                closeMobileMenu();
              }
            }
          });
        }
      });
    </script>

    <!-- 🔍 Modal de Notas -->
    <div id="notesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
      <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl p-6">
        <!-- Header -->
        <div class="flex justify-between items-center mb-4">
          <h3 id="notesModalTitle" class="text-xl font-bold text-gray-800">Notas para DESTINO</h3>
          <button onclick="closeNotesModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>

        <!-- Lista de Notas -->
        <div id="notesListModal" class="space-y-3 max-h-60 overflow-y-auto">
          <p class="text-gray-500 text-sm">No hay notas registradas aún.</p>
        </div>

      </div>
    </div>

  </div>

  <!-- 🔹 Lex AI Assistant (avatar flotante) -->
  <div id="lexAssistant" class="fixed bottom-4 right-4 z-60 flex flex-col items-end gap-2 select-none">

    <!-- Globito de mensaje de Lex (encima del avatar) -->
    <div id="lexBubble"
      class="hidden max-w-xs text-xs rounded-2xl shadow-lg px-3 py-2 mb-2 bg-slate-900/95 border border-slate-700">
      <p id="lexBubbleText" class="font-medium text-slate-50">
        Hola, soy Lex. Te ayudaré con tus decisiones de carga. 👋
      </p>

      <div class="mt-2 flex items-center gap-2">
        <button id="lexQuickAnalyzeBtn" type="button" class="lex-action-btn lex-btn-analyze"
          onclick="window.triggerLex && window.triggerLex()">
          ⚡ Análisis
        </button>

        <button id="lexOpenChatBtn" type="button" class="lex-action-btn lex-btn-chat"
          onclick="window.openLexChatModal && window.openLexChatModal()">
          💬 Chat
        </button>
      </div>
    </div>



    <!-- Avatar -->
    <div class="relative">
      <div class="lex-avatar-shell w-16 h-16 rounded-full bg-gradient-to-br from-blue-600 to-purple-700 
                border border-blue-400 shadow-2xl flex items-center justify-center overflow-hidden">
        <img id="lexAvatarImg" src="img/lex/lex-neutral.png" alt="Lex AI Assistant"
          class="w-14 h-14 object-contain lex-avatar-img">
      </div>

      <!-- Puntico de estado -->
      <span id="lexStatusDot"
        class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-slate-900 bg-emerald-400 shadow-lg">
      </span>
    </div>
  </div>




</body>

</html>
